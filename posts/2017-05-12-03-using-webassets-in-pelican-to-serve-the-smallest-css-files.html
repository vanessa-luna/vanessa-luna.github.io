<!DOCTYPE html>
<html lang="en">
<head>
	<title>Using WebAssets in Pelican to serve small css files | Vanessa & Luna</title>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel=icon href=/images/favicon.png>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-100867520-1', 'auto');
		ga('send', 'pageview');
</script>
	<link rel="stylesheet" href="https://vanessa-luna.github.io/theme/css/article.min.css?790838c1">
	
    <script type="text/javascript">
      function gh(s) { return parseInt(s.replace(/.+x/, '')) }
      var imageSizes = [{name:"huge", h:gh("?x1080")}, {name:"medium", h:gh("?x480")}, {name:"tiny", h:gh("?x144")}, {name:"large", h:gh("?x720")}, {name:"smaller", h:gh("?x240")}, {name:"small", h:gh("?x360")}]
      imageSizes.sort(function(a,b) {return (a.h > b.h) ? -1 : ((b.h > a.h) ? 1 : 0);} );

      function imgUrlByHeight(filename, h) {
        var chosenSize = imageSizes[0]; //start at smallest size
        for (var i = 0; i < imageSizes.length; i++){ // redo smallest to calculate abs
          var curSize = imageSizes[i];
          curSize.abs = Math.abs(h - curSize.h);
          if (curSize.abs <= chosenSize.abs) chosenSize = curSize;
        }
        return "url(https://vanessa-luna.github.io/thumb/" + chosenSize.name + "/" + filename;
      }
    </script>
</head>
<body>
	<div class="sidebar">
		<div class="sidebar" id='sidebar-bg' style="background-image:url('https://vanessa-luna.github.io/thumb/huge/backgrounds/25cover.jpg')">
			<!-- dynamically load a different bg image -->
			<script type="text/javascript">
			    document.addEventListener("DOMContentLoaded", function (e) {
					var sb = document.getElementById('sidebar-bg');
					var filename = "backgrounds/" + (parseInt((Math.random() * 25 ))) + "cover.jpg)"
					sb.style.backgroundImage = imgUrlByHeight(filename, sb.clientHeight);
					sb.style.backgroundPosition = parseInt((Math.random() * 100)) + "%";
			    });
				function chooseIcon(list){ return list[parseInt(Math.random()*list.length)]; }
			</script>
		</div>
		<div class="headline">
			<a id="secret" href='/s' tabindex="-1"></a>
			<a id="home" href="/">
				<img class="profile-picture" src="https://vanessa-luna.github.io/images/favicon.png"></img>
				<h1>Vanessa &#xe80a; Luna</h1>
			</a>
			<p class="subtitle">A reflection of your experience: as moonlight is a reflection of sunlight.</p>
		</div>
		<nav class="menu">
			<div class="menu-item ">
				<a href="/">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Home").className = "fa fa-" +  chooseIcon(["flight","rocket","fighter-jet","space-shuttle"]); });
							</script>
							<i id="icon-Home" class="fa fa-flight"></i>
						</div>
						<span class='name'>Home</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/categories">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Categories").className = "fa fa-" +  chooseIcon(["leaf","feather","tree-2"]); });
							</script>
							<i id="icon-Categories" class="fa fa-leaf"></i>
						</div>
						<span class='name'>Categories</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/archives/">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Archive").className = "fa fa-" +  chooseIcon(["hourglass-3","hourglass-2","hourglass-1"]); });
							</script>
							<i id="icon-Archive" class="fa fa-hourglass-3"></i>
						</div>
						<span class='name'>Archive</span>
					</div>
				</a>
			</div>
			<div class="menu-item spacer">
			</div>
			<div class="menu-item ">
				<a href="/images">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Gallery").className = "fa fa-" +  chooseIcon(["picture","eye-off","eye"]); });
							</script>
							<i id="icon-Gallery" class="fa fa-picture"></i>
						</div>
						<span class='name'>Gallery</span>
					</div>
				</a>
			</div>
			<div class="menu-item spacer">
			</div>
			<div class="menu-item ">
				<a href="/about">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-About").className = "fa fa-" +  chooseIcon(["dot-circled","sun-1"]); });
							</script>
							<i id="icon-About" class="fa fa-dot-circled"></i>
						</div>
						<span class='name'>About</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/contact">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Contact").className = "fa fa-" +  chooseIcon(["thumbs-up","hand-paper-o","hand-scissors-o","hand-grab-o"]); });
							</script>
							<i id="icon-Contact" class="fa fa-thumbs-up"></i>
						</div>
						<span class='name'>Contact</span>
					</div>
				</a>
			</div>
		</nav>
	</div>
	<div class="content">
 <div class="min-height-full pad-content">
	<div class="post">
		<h1 class="post-title">Using WebAssets in Pelican to serve small css files</h1>
		<span class="post-date">web-dev ~ 2017-05-12</span>
		<br><br>

		<p>I cared a lot about mobile bandwidth usage. One of the things I focused on was condensing my css as much as possible.
</p>
<h2 id="webassets">WebAssets</h2>
<p>This is a cool Python tool to help manage assets in your web projects. Lol. Some made a simple <a class="internal" href="(https://github.com/getpelican/pelican-plugins/tree/master/assets)">plugin for Pelican</a> to integrate it into the system</p>
<p>Using modular css files and webassets, I can serve only the css styles that are required per page, without dumping all css selectors on every page.</p>
<p>Bear with me on this one.</p>
<h5 id="pelican-settings-file">Pelican settings file</h5>
<div class="highlight"><pre><span></span><span class="n">PLUGIN_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plugins&#39;</span><span class="p">]</span>
<span class="n">PLUGINS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;assets&#39;</span><span class="p">]</span>

<span class="n">ASSET_SOURCE_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;helpers&#39;</span><span class="p">]</span>
</pre></div>


<p>I tell the plugin which paths to look into for files I will be using later.</p>
<div class="highlight"><pre><span></span><span class="n">ASSET_CSS_BASE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;css/base.css&#39;</span><span class="p">,</span> <span class="s1">&#39;css/fragments/sidebar.css&#39;</span><span class="p">]</span>
<span class="n">ASSET_CSS_CONTENT</span> <span class="o">=</span> <span class="n">ASSET_CSS_BASE</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/fragments/content.css&#39;</span><span class="p">,</span> <span class="s1">&#39;css/fragments/syntax.css&#39;</span><span class="p">]</span>
<span class="n">ASSET_CSS_PAGINATED</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;css/fragments/pagination.css&#39;</span><span class="p">]</span>
<span class="n">ASSET_CSS_COMMENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;css/fragments/comments.css&#39;</span><span class="p">]</span>
<span class="n">ASSET_CSS_GALLERY</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fotorama/fotorama.css&#39;</span><span class="p">,</span> <span class="s1">&#39;css/fragments/gallery.css&#39;</span><span class="p">]</span>
</pre></div>


<p>Here I am creating some reusable, easily referenced lists containing paths to the files I will bundle together</p>
<div class="highlight"><pre><span></span><span class="n">ASSET_BUNDLES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;css-base&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_BASE</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/base.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">,</span> <span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-archives&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_BASE</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/archives.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/archives.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-article&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_CONTENT</span> <span class="o">+</span> <span class="n">ASSET_CSS_PAGINATED</span> <span class="o">+</span> <span class="n">ASSET_CSS_COMMENTS</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/article.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/article.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

        <span class="p">,(</span><span class="s1">&#39;css-fragment-gallery&#39;</span><span class="p">,</span>
            <span class="n">ASSET_CSS_GALLERY</span><span class="p">,</span>
            <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/fragments/gallery-fragment.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-categories&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_BASE</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/categories.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/categories.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-category&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_CONTENT</span> <span class="o">+</span> <span class="n">ASSET_CSS_PAGINATED</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/index.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/category.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-index&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_CONTENT</span> <span class="o">+</span> <span class="n">ASSET_CSS_PAGINATED</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/index.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/index.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;css-page&#39;</span><span class="p">,</span>
        <span class="n">ASSET_CSS_BASE</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/page.css&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/page.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

        <span class="p">,(</span><span class="s1">&#39;css-gallery&#39;</span><span class="p">,</span>
            <span class="n">ASSET_CSS_BASE</span> <span class="o">+</span> <span class="n">ASSET_CSS_GALLERY</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;css/pages/gallery.css&#39;</span><span class="p">],</span>
            <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;css/pages/gallery.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;yui_css&#39;</span><span class="p">})</span>

    <span class="p">,(</span><span class="s1">&#39;js-gallery&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s1">&#39;jquery/jquery.min.js&#39;</span><span class="p">,</span> <span class="s1">&#39;fotorama/fotorama.js&#39;</span><span class="p">],</span>
        <span class="p">{</span><span class="s1">&#39;output&#39;</span><span class="p">:</span><span class="s1">&#39;js/gallery.js&#39;</span><span class="p">})</span>
<span class="p">]</span>
</pre></div>


<p>The <code>ASSETS</code> is the fun part. It accepts a Tuple of three values <code>(name, files, options)</code> I won't go into all the details of using the plugin, but you should be able to discern how I split up my css code and only included what was necessary.</p>
<p>I am using font awesome for some of my icons. I may convert them to images at some point, but I did only include the css class that I needed instead of the entire library.</p>
<p>The biggest culprits here for filesize are of course: jquery and fotorama. I want to change lightbox/gallery library but it's turning out to be a much harder problem than I hoped for.</p>
<h5 id="basehtml-jinja-template-file">base.html - Jinja template file</h5>
<div class="highlight"><pre><span></span><span class="x">...</span>
<span class="x">    &lt;head&gt;</span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">assets</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;/head&gt;</span>
<span class="x">...</span>
</pre></div>


<p>Above, not all is included, but what is important is defining a block I can use to put the assets inside the head.</p>
<p>Inside of any page that extends base.html I can put this:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">assets</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">assets</span> <span class="s2">&quot;css-index&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span class="cp">{{</span> <span class="nv">SITEURL</span> <span class="cp">}}</span><span class="x">/</span><span class="cp">{{</span> <span class="nv">ASSET_URL</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endassets</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>


<p>Thus allowing me to reference the proper WebAssets bundle within the relevant file.</p>
<h4 id="finally">Finally</h4>
<p>I'm pretty happy with this one. With a simple abstraction of content, and a relatively low overhead addition of process, I was able to knock off about 20k+ in bloat by only serving the css that's required.</p>

	</div>








      <div class="pagination">














































































































































        <div class="pagination-item">
    <a class="box" href="/posts/2017-05-12-02-dynamic-image-sizes.html">
        <span class="newer">Newer</span>
    </a>
</div>


        <span class="pagination-spacer"></span>

        <div class="pagination-item">
    <a class="box" href="/posts/2017-05-12-04-adding-soundloud-widget-to-pelican-using-jinja.html">
        <span class="older">Older</span>
    </a>
</div>






































      </div>
<div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">Comments</a> are loading... I hope ;)</div>
<script>
hcb_user = {
    no_comments_msg: 'Be the first to leave a comment',
    // submit form
    comments_header : 'Comments',
    name_label : 'Name (optional)',
    email_label:'Email (optional)',
    website_label:'Website (optional)',
    content_label: 'Message',
    submit : 'Submit',
    add:'Leave a comment',
    again: 'Post another comment',
    subscribe:'subscribe (email updates)',
    // user actions
    logout_link : '<img title="log out" src="//www.htmlcommentbox.com/static/images/door_out.png" alt="[logout]" class="hcb-icon"/>',
    admin_link : '<img src="//www.htmlcommentbox.com/static/images/door_in.png" alt="[login]" class="hcb-icon"/>',
    del_link : '<img src="//www.htmlcommentbox.com/static/images/door_in.png" alt="[login]" class="hcb-icon"/>',
    rss:'<img src="//www.htmlcommentbox.com/static/images/feed.png" class="hcb-icon" alt="rss"/> ',
    // comment body
    said:'',
    anonymous:'anon',
    mod_label:'(owner)',
    // dates
    days_ago:'days',
    hours_ago:'hours',
    minutes_ago:'mins',
    within_the_last_minute:'<1 min',
    // comment actions
    reply:"<i class='fa fa-reply'></i> reply",
    flag:"<i class='fa fa-flag-filled'></i> flag",
    like:"",//"<i class='fa fa-thumbs-up-1'></i> like",
    are_you_sure:'Really flag this comment as inappropriate?',
    // pagination
    prev_page: "<a><i class='fa fa-angle-double-left'></i> Newer </a>",
    showing:'comments',
    to:'-',
    next_page: "<a> Older <i class='fa fa-angle-double-right'></i> </a>",

    msg_thankyou:'<span class="success-span">You left a comment!</span>',
    msg_approval:'<span class="info-span">Thank you for commenting! Your comment will appear once approved by a moderator.</span>',
    msg_approval_required:'<span class="info-span">Thank you for commenting! Your comment will appear once approved by a moderator.</span>',

    err_bad_html:'<span class="warning-span">Your comment contained bad html.</span>',
    err_bad_email:'<span class="warning-span">Please enter a valid email address.</span>',
    err_too_frequent:'<span class="warning-span">You must wait a few seconds between posting comments.</span>',
    err_comment_empty:'<span class="warning-span">Cannot leave empty comments!</span>',
    err_denied:'<span class="success">Your comment was not accepted.</span>',

    //SETTINGS
    MAX_CHARS: 8192,
    PAGE:"posts/2017-05-12-03-using-webassets-in-pelican-to-serve-the-smallest-css-files.html",
    RELATIVE_DATES:true
};
</script>
<script type="text/javascript" id="hcb"> /*<!--*/
    if(!window.hcb_user){hcb_user={};} (function(){var s=document.createElement("script"), l=hcb_user.PAGE || (""+window.location).replace(/'/g,"%27"), h="//www.htmlcommentbox.com";s.setAttribute("type","text/javascript");s.setAttribute("src", h+"/jread?page="+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24aIzV1Bc59Aa3mSLIqa22X%2F"+"&opts=17167&num=5&ts=1508972406887");if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})(); /*-->*/ </script>
<noscript>
    <style>#HCB_comment_box { display:none;}</style>
    <div>
        <h3>Comments</h3>
        <p class="warning-block">Enable Javascript to view or write comments</p>
    </div>
</noscript>
</div>
        <div class="footer">
            <a href="/licenses">licenses</a> <i class="fa fa-star"></i>
            <i class="fa fa-copyright"></i> 2017 Vanessa & Luna
            <i class="fa fa-star"></i> built on <a href="http://getpelican.com" target="_blank">pelican</a>
        </div>
	</div>
</body>
</html>