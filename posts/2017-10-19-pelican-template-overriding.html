<!DOCTYPE html>
<html lang="en">
<head>
	<title>Overriding templates in Pelican when using multiple configs | Vanessa & Luna</title>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel=icon href=/images/favicon.png>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-100867520-1', 'auto');
		ga('send', 'pageview');
</script>
	<link rel="stylesheet" href="https://vanessa-luna.github.io/theme/css/article.min.css?e420b04d">
	
    <script type="text/javascript">
      function gh(s) { return parseInt(s.replace(/.+x/, '')) }
      var imageSizes = [{name:"huge", h:gh("?x1080")}, {name:"medium", h:gh("?x480")}, {name:"tiny", h:gh("?x144")}, {name:"large", h:gh("?x720")}, {name:"smaller", h:gh("?x240")}, {name:"small", h:gh("?x360")}]
      imageSizes.sort(function(a,b) {return (a.h > b.h) ? -1 : ((b.h > a.h) ? 1 : 0);} );

      function imgUrlByHeight(filename, h) {
        var chosenSize = imageSizes[0]; //start at smallest size
        for (var i = 0; i < imageSizes.length; i++){ // redo smallest to calculate abs
          var curSize = imageSizes[i];
          curSize.abs = Math.abs(h - curSize.h);
          if (curSize.abs <= chosenSize.abs) chosenSize = curSize;
        }
        return "url(https://vanessa-luna.github.io/thumb/" + chosenSize.name + "/" + filename;
      }
    </script>
</head>
<body>
	<div class="sidebar">
		<div class="sidebar" id='sidebar-bg' style="background-image:url('https://vanessa-luna.github.io/thumb/huge/backgrounds/26cover.jpg')">
			<!-- dynamically load a different bg image -->
			<script type="text/javascript">
			    document.addEventListener("DOMContentLoaded", function (e) {
					var sb = document.getElementById('sidebar-bg');
					var filename = "backgrounds/" + (parseInt((Math.random() * 26 ))) + "cover.jpg)"
					sb.style.backgroundImage = imgUrlByHeight(filename, sb.clientHeight);
					sb.style.backgroundPosition = parseInt((Math.random() * 100)) + "%";
			    });
				function chooseIcon(list){ return list[parseInt(Math.random()*list.length)]; }
			</script>
		</div>
		<div class="headline">
			<a id="secret" href='/s' tabindex="-1"></a>
			<a id="home" href="/">
				<img class="profile-picture" src="https://vanessa-luna.github.io/images/favicon.png"></img>
				<h1>Vanessa &#xe80a; Luna</h1>
			</a>
			<p class="subtitle">A reflection of your experience: as moonlight is a reflection of sunlight.</p>
		</div>
		<nav class="menu">
			<div class="menu-item ">
				<a href="/">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Home").className = "fa fa-" +  chooseIcon(["flight","rocket","fighter-jet","space-shuttle"]); });
							</script>
							<i id="icon-Home" class="fa fa-flight"></i>
						</div>
						<span class='name'>Home</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/categories">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Categories").className = "fa fa-" +  chooseIcon(["leaf","feather","tree-2"]); });
							</script>
							<i id="icon-Categories" class="fa fa-leaf"></i>
						</div>
						<span class='name'>Categories</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/archives/">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Archive").className = "fa fa-" +  chooseIcon(["hourglass-3","hourglass-2","hourglass-1"]); });
							</script>
							<i id="icon-Archive" class="fa fa-hourglass-3"></i>
						</div>
						<span class='name'>Archive</span>
					</div>
				</a>
			</div>
			<div class="menu-item spacer">
			</div>
			<div class="menu-item ">
				<a href="/images">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Gallery").className = "fa fa-" +  chooseIcon(["picture","eye-off","eye"]); });
							</script>
							<i id="icon-Gallery" class="fa fa-picture"></i>
						</div>
						<span class='name'>Gallery</span>
					</div>
				</a>
			</div>
			<div class="menu-item spacer">
			</div>
			<div class="menu-item ">
				<a href="/about">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-About").className = "fa fa-" +  chooseIcon(["dot-circled","sun-1"]); });
							</script>
							<i id="icon-About" class="fa fa-dot-circled"></i>
						</div>
						<span class='name'>About</span>
					</div>
				</a>
			</div>
			<div class="menu-item ">
				<a href="/contact">
					<div class="menu-item-content">
						<div class='icon'>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function (e) { document.getElementById("icon-Contact").className = "fa fa-" +  chooseIcon(["thumbs-up","hand-paper-o","hand-scissors-o","hand-grab-o"]); });
							</script>
							<i id="icon-Contact" class="fa fa-thumbs-up"></i>
						</div>
						<span class='name'>Contact</span>
					</div>
				</a>
			</div>
		</nav>
	</div>
	<div class="content">
 <div class="min-height-full pad-content">
	<div class="post">
		<h1 class="post-title">Overriding templates in Pelican when using multiple configs</h1>
		<span class="post-date">web-dev ~ 2017-10-19</span>
		<br><br>

		<p>This website and all its pieces now needs 4 pelican config files. And the latest addition requires different direct templates than the others. So I needed a way to override the direct templates without royally fucking anything else up. This is what I came up with.</p>
<p></p>
<h2 id="setup">Setup</h2>
<p>I have 4 pelican configs. The main config <code>blog_conf.py</code> is what builds this  website. The second one 'secret_conf.py' builds my secret portion of the website. The third <code>thumbs_conf.py</code> builds only the thumbnails so I do not waste space on my HDD by using symlinks. The fourth <code>product.py</code> builds the product page I am working on now, which relies on the css and general templates I have already created.</p>
<p>Thankfully I have a few key abstractions in place that made this go surprisingly smooth.</p>
<ul>
<li>All of my configs inherit from the <code>blog_conf.py</code> to be as DRY as possible which eliminates duplication of efforts. Especially in the plugins department</li>
<li>I use the <code>webassets</code> plugin to handle my css and js linking</li>
<li>My css is broken into small pieces so it's easily manageable which styles end up which page. See <a class="internal" href="https://vanessa-luna.github.io/posts/2017-05-12-03-using-webassets-in-pelican-to-serve-the-smallest-css-files.html">this post</a></li>
<li>I use a <code>base.html</code> jinja template that all other templates inherit from</li>
</ul>
<h2 id="fix">FIX:</h2>
<p>FIRST, update generators.py so it will search EXTRA_TEMPLATES_PATHS first. Otherwise you cannot use extra tempaltes for override</p>
<p><strong>generators.py</strong></p>
<p>This is what I changed to get this magic to happen... Look between the "THESE LINES" lines :p</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Generator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Baseclass generator&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span>
        <span class="o">....</span>
        <span class="c1"># templates cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templates</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># __________THESE LINES __________</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templates_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;EXTRA_TEMPLATES_PATHS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templates_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theme</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)))</span>
        <span class="c1"># ______________________________</span>
</pre></div>


<h2 id="example">Example</h2>
<p>Then in our extra folder we can "override" the templates we need to modify. Because of our setup with the base.html and webassets with piecemeal css it is easy to slap in the extra css needed to override styles from the original theme. Although this does kill my "one css file per page rule". Whatever.</p>
<p><strong>blog_conf.py</strong></p>
<p>This is the main pelican conf that builds the root content</p>
<div class="highlight"><pre><span></span><span class="n">THEME</span>                      <span class="o">=</span> <span class="s1">&#39;theme&#39;</span>
<span class="n">DIRECT_TEMPLATES</span>           <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;archives&#39;</span><span class="p">]</span>
<span class="n">PAGINATED_DIRECT_TEMPLATES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
<span class="n">EXTRA_TEMPLATES_PATHS</span>      <span class="o">=</span> <span class="p">[]</span>
</pre></div>


<p><strong>product.py</strong></p>
<p>This is the pelican conf that builds the product content in <URL>/product. <strong>Note</strong> that I import the main blog conf to avoid repetition in simplify changes in the future. DRY as can be!</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blog_conf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">THEME</span>                      <span class="o">=</span> <span class="s1">&#39;theme&#39;</span>
<span class="n">DIRECT_TEMPLATES</span>           <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;archives&#39;</span><span class="p">]</span>
<span class="n">PAGINATED_DIRECT_TEMPLATES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>
<span class="n">EXTRA_TEMPLATES_PATHS</span>      <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;theme/templates/product&#39;</span><span class="p">]</span>
</pre></div>


<p>This is my folder structure</p>
<div class="highlight"><pre><span></span>theme/templates/
    base.html
    archives.html
    index.html
    fragments/
        sidebar.html
        footer.html
    product/
        base.html
        index.html
        fragments/
            menu.html
            footer.html
</pre></div>


<p><strong>theme/templates/base.html</strong></p>
<p>This is the ROOT base.html I use. Note the sidebar and footer fragments</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;{{ DEFAULT_LANG }}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block page_title %}{% endblock page_title %} | Main Blog<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% include &#39;fragments/head.html&#39; %}
    {% block assets %} {% endblock %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {% include &#39;fragments/sidebar.html&#39; %}
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
        {% block title %} {% endblock %}
        {% block content %} {% endblock %}
        {% include &#39;fragments/footer.html&#39; %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p><strong>theme/templates/<em>product</em>/base.html</strong></p>
<p>NOTE: I remove the above sidebar and put in the menu. I add in another asset reference that will override some of the other default css from the original theme using the webassets plugin. Pelican plugins FTW! :+1:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;{{ DEFAULT_LANG }}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{% block page_title %}{% endblock page_title %} | Product<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    {% include &#39;fragments/head.html&#39; %}
    {% block assets %} {% endblock %}
    {% assets &quot;css-product-base&quot; %}
        <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ SITEURL }}/{{ ASSET_URL }}&quot;</span><span class="p">&gt;</span>
    {% endassets %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
        {% include &#39;fragments/menu.html&#39; %}
        {% block title %} {% endblock %}
        {% block content %} {% endblock %}
        {% include &#39;fragments/footer.html&#39; %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p><strong>theme/templates/archives.html</strong></p>
<p>This is where it gets awesome. While this relative url in the archive folder looks like it is pointing to the same folder, the environment picks up the base.html in the product folder first. So we need to change nothing in order to reuse the same template but get all the same benefits. The power of abstraction right? :rofl:</p>
<div class="highlight"><pre><span></span>{% extends &quot;base.html&quot; %}
</pre></div>

	</div>








      <div class="pagination">










































































































        <div class="pagination-item">
    <a class="box" href="/posts/2017-10-22-chronic-pain.html">
        <span class="newer">Newer</span>
    </a>
</div>


        <span class="pagination-spacer"></span>

        <div class="pagination-item">
    <a class="box" href="/posts/2017-10-18-cold.html">
        <span class="older">Older</span>
    </a>
</div>































































































































      </div>
<div id="HCB_comment_box"><a href="http://www.htmlcommentbox.com">Comments</a> are loading... I hope ;)</div>
<script>
hcb_user = {
    no_comments_msg: 'Be the first to leave a comment',
    // submit form
    comments_header : 'Comments',
    name_label : 'Name (optional)',
    email_label:'Email (optional)',
    website_label:'Website (optional)',
    content_label: 'Message',
    submit : 'Submit',
    add:'Leave a comment',
    again: 'Post another comment',
    subscribe:'subscribe (email updates)',
    // user actions
    logout_link : '<img title="log out" src="//www.htmlcommentbox.com/static/images/door_out.png" alt="[logout]" class="hcb-icon"/>',
    admin_link : '<img src="//www.htmlcommentbox.com/static/images/door_in.png" alt="[login]" class="hcb-icon"/>',
    del_link : '<img src="//www.htmlcommentbox.com/static/images/door_in.png" alt="[login]" class="hcb-icon"/>',
    rss:'<img src="//www.htmlcommentbox.com/static/images/feed.png" class="hcb-icon" alt="rss"/> ',
    // comment body
    said:'',
    anonymous:'anon',
    mod_label:'(owner)',
    // dates
    days_ago:'days',
    hours_ago:'hours',
    minutes_ago:'mins',
    within_the_last_minute:'<1 min',
    // comment actions
    reply:"<i class='fa fa-reply'></i> reply",
    flag:"<i class='fa fa-flag-filled'></i> flag",
    like:"",//"<i class='fa fa-thumbs-up-1'></i> like",
    are_you_sure:'Really flag this comment as inappropriate?',
    // pagination
    prev_page: "<a><i class='fa fa-angle-double-left'></i> Newer </a>",
    showing:'comments',
    to:'-',
    next_page: "<a> Older <i class='fa fa-angle-double-right'></i> </a>",

    msg_thankyou:'<span class="success-span">You left a comment!</span>',
    msg_approval:'<span class="info-span">Thank you for commenting! Your comment will appear once approved by a moderator.</span>',
    msg_approval_required:'<span class="info-span">Thank you for commenting! Your comment will appear once approved by a moderator.</span>',

    err_bad_html:'<span class="warning-span">Your comment contained bad html.</span>',
    err_bad_email:'<span class="warning-span">Please enter a valid email address.</span>',
    err_too_frequent:'<span class="warning-span">You must wait a few seconds between posting comments.</span>',
    err_comment_empty:'<span class="warning-span">Cannot leave empty comments!</span>',
    err_denied:'<span class="success">Your comment was not accepted.</span>',

    //SETTINGS
    MAX_CHARS: 8192,
    PAGE:"posts/2017-10-19-pelican-template-overriding.html",
    RELATIVE_DATES:true
};
</script>
<script type="text/javascript" id="hcb"> /*<!--*/
    if(!window.hcb_user){hcb_user={};} (function(){var s=document.createElement("script"), l=hcb_user.PAGE || (""+window.location).replace(/'/g,"%27"), h="//www.htmlcommentbox.com";s.setAttribute("type","text/javascript");s.setAttribute("src", h+"/jread?page="+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24aIzV1Bc59Aa3mSLIqa22X%2F"+"&opts=17167&num=5&ts=1508972406887");if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})(); /*-->*/ </script>
<noscript>
    <style>#HCB_comment_box { display:none;}</style>
    <div>
        <h3>Comments</h3>
        <p class="warning-block">Enable Javascript to view or write comments</p>
    </div>
</noscript>
</div>
        <div class="footer">
            <a href="/licenses">licenses</a> <i class="fa fa-star"></i>
            <i class="fa fa-copyright"></i> 2017 Vanessa & Luna
            <i class="fa fa-star"></i> built on <a href="http://getpelican.com" target="_blank">pelican</a>
        </div>
	</div>
</body>
</html>